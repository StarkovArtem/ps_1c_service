# Скрипты для обслуживания серверов 1С на Windows

Набор PowerShell скриптов для автоматизации обслуживания серверов 1С предприятия.

## Установка

Для установки выполните команду:

```powershell
irm https://raw.githubusercontent.com/StarkovArtem/ps_1c_service/refs/heads/main/setup.ps1 | iex
```

После выполнения команды откроется меню установки, где можно выбрать путь для установки скриптов (по умолчанию `C:\ps_1c_service`).

## Описание скриптов

### Скрипт №1: `check-1C-lgd_bases.ps1`

Проверяет все базы локального кластера 1С на предмет использования старого формата лога (lgd).

**Функциональность:**
- Сканирует все информационные базы локального кластера
- Проверяет формат файлов логов
- Выявляет базы, использующие устаревший формат lgd
- Формирует отчет о результатах проверки

### Скрипт №2: `shrink_1C_log.ps1`

Управляет файлами логов 1С: удаляет или перемещает файлы логов сверх установленного лимита.

**Функциональность:**
- Анализирует размер и количество файлов логов
- Удаляет старые логи согласно заданным лимитам
- Сохраняет необходимое количество последних логов
- Поддерживает настройку лимитов хранения

**Конфигурационные параметры:**

```powershell
# Конфигурация
$LogFolderPath = "C:\Program Files\1cv8\srvinfo"  # Путь к папке с логами 1С
$MaxSizeMB = 500                                  # Максимальный размер логов в МБ
$LogExtensions = @("*.lgp", "*.lgx")              # Расширения файлов логов для обработки

# Параметры обработки
$DeleteOverSize = $false                          # true - удалять файлы превышающие лимит, false - только показывать
$MoveTo = ""                                      # UNC-путь к сетевой папке для перемещения (например: "\\server\logs\1C")
$NetworkLogin = ""                                # Логин для доступа к сетевой папке
$NetworkPassword = ""                             # Пароль для доступа к сетевой папке
```

**Описание параметров:**
- **`$LogFolderPath`** - путь к папке с логами кластера 1С (по умолчанию стандартный путь установки)
- **`$MaxSizeMB`** - максимальный допустимый размер всех логов в мегабайтах (при превышении будут удалены/перемещены самые старые логи)
- **`$LogExtensions`** - массив расширений файлов логов для обработки (по умолчанию обрабатываются lgp и lgx файлы)
- **`$DeleteOverSize`** - режим работы: `$true` - фактически удалять файлы, `$false` - только показывать какие файлы будут удалены (режим предпросмотра)
- **`$MoveTo`** - если указан, файлы будут перемещены в эту сетевую папку вместо удаления
- **`$NetworkLogin`** и **`$NetworkPassword`** - учетные данные для доступа к сетевой папке, если требуется аутентификация

## Использование

После установки все скрипты будут доступны в выбранной директории. Для запуска скриптов используйте PowerShell.

## Требования

- Windows Server/Windows 10/11
- PowerShell 5.0 или выше
- Права администратора (для некоторых операций)

## Лицензия

MIT License
```